extends layout

block content
  .container
    .row
      .col-md-12
        .text-center(style='margin-bottom: 40px;')
          div(style='font-size: 64px; margin-bottom: 15px;') üì¶
          h1(style='font-size: 36px; font-weight: 700; margin-bottom: 10px;') Blockchain Block
          p.lead(style='color: #64748b;') Understand how mining works by finding a valid hash

        .well(style='background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; margin-bottom: 30px;')
          .row
            .col-md-12.text-center
              h3(style='color: white; margin-bottom: 15px;') ‚õèÔ∏è Mining Explained
              p(style='font-size: 16px; opacity: 0.95; margin: 0;')
                | Mining is the process of finding a nonce that produces a hash starting with four zeros (0000...)

        .well#block1chain1well(style='padding: 30px;')
          form.form-horizontal

            .form-group
              label.control-label(for='block1chain1number')
                span(style='margin-right: 8px;') #Ô∏è‚É£
                | Block Number
              .input-group
                span.input-group-addon(style='background: #f8fafc; border-color: #e2e8f0;') #
                input#block1chain1number.form-control(type='number', value='1')

            .form-group
              label.control-label(for='block1chain1nonce')
                span(style='margin-right: 8px;') üé≤
                | Nonce
              input#block1chain1nonce.form-control(type='text', value='0')
              p.text-muted The magic number that makes the hash valid

            .form-group
              label.control-label(for='block1chain1data')
                span(style='margin-right: 8px;') üìù
                | Block Data
              textarea#block1chain1data.form-control(rows='6')

            .form-group
              label.control-label(for='block1chain1hash')
                span(style='margin-right: 8px;') üîê
                | Block Hash
              input#block1chain1hash.form-control(type='text', disabled)
              p.text-muted Hash must start with 0000 to be valid

            .form-group
              button#block1chain1mineButton.btn.btn-success.btn-lg.ladda-button(
                type='button',
                data-style='expand-right',
                style='width: 100%; padding: 15px; font-size: 18px; font-weight: 600;'
              )
                span.ladda-label
                  span(style='margin-right: 10px;') ‚õèÔ∏è
                  | Start Mining

            .form-group
              button#saveBlock.btn.btn-primary.btn-lg(
                type='button',
                style='width: 100%; padding: 12px; margin-top: 15px;'
              )
                | Save Block

        .row(style='margin-top: 30px;')
          .col-md-6
            .well(style='background: #eff6ff; border-color: #93c5fd;')
              h4(style='color: #2563eb; margin-top: 0;')
                span(style='margin-right: 8px;') ‚úÖ
                | Valid Block
              p(style='color: #64748b;')
                | When hash starts with 0000, block is valid

          .col-md-6
            .well(style='background: #fef2f2; border-color: #fca5a5;')
              h4(style='color: #ef4444; margin-top: 0;')
                span(style='margin-right: 8px;') ‚ùå
                | Invalid Block
              p(style='color: #64748b;')
                | If the hash doesn't start with 0000, you must mine again

    // LOAD existing mining javascript
    script(src='/javascripts/block.js')

    // SAVE BLOCK AJAX HANDLER
    script.
      $(function () {

        // Save block event
        $('#saveBlock').click(function () {

          const blockNumber = $('#block1chain1number').val();
          const nonce = $('#block1chain1nonce').val();
          const data = $('#block1chain1data').val();
          const hash = $('#block1chain1hash').val();
          const previousHash = "0"; // For block #1 only

          if (!hash.startsWith('0000')) {
            alert("‚ùå Hash is invalid. Please mine again.");
            return;
          }

          $.ajax({
            url: '/api/blocks',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
              blockNumber: blockNumber,
              data: data,
              previousHash: previousHash,
              hash: hash,
              nonce: nonce,
              difficulty: 4,
              miner: 'local-user'
            }),
            success: function () {
              alert("‚úÖ Block saved successfully!");
            },
            error: function (err) {
              alert("‚ùå Error saving block: " + err.responseText);
            }
          });

        });

      });
